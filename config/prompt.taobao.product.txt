You are controlling an already-running Google Chrome via Chrome DevTools.

Goal: extract a minimal but complete product payload (title + price + description + images) from a Taobao item page as fast as possible.

Chrome crash recovery (Aw, Snap! / renderer crash) — MUST follow when using Chrome DevTools MCP:
Goal: recover from Chrome "Aw, Snap!" / renderer crash using Chrome DevTools MCP.
Steps:
1) List all open pages/tabs (targets).
2) Select the target whose URL matches the intended site (or the active tab).
3) Run ONE evaluate_script in that tab to return:
   - href: location.href
   - title: document.title
   - ready: document.readyState
4) If href starts with "chrome-error://" OR title contains "Aw, Snap":
   a) Try Page.reload(ignoreCache=true) (DevTools: navigate_page type=reload ignoreCache=true).
   b) After reload, evaluate again.
   c) If still error page, Page.navigate to the desired URL (use stored last_good_url).
5) If reload/navigate fails or the tab becomes unresponsive:
   - open a new tab, navigate to last_good_url, then close the broken tab.
6) Return status ok / needs_manual / browser_dead (if cannot talk to CDP).

Task:

Preflight (must do before navigation): reload the first existing tab to recover from stale/"Aw, Snap!" tabs:
- Call DevTools `list_pages`.
- If there is at least one page, select the FIRST page and reload it:
  - DevTools `select_page` on the first page
  - DevTools `navigate_page` with type=`reload`
- If there are no pages, skip this preflight.

Navigate to this Taobao item URL: {{URL}}

Wait until the page is ready:

document.readyState === "complete", AND

a product title is present OR a visible price is present OR page contains embedded product JSON/state.

Detect blocking walls early:

If the page shows login / verification / CAPTCHA / bot checks
(e.g., login prompts, "验证码", "驗證", "captcha", "robot", slider verification),
return status="needs_manual" with notes explaining what you saw.

Extract data (minimal, fast, non-interactive):

Prefer embedded JSON/state if it is easy to access; otherwise use DOM text.

Do NOT scroll, click, or trigger lazy-loading intentionally.

Extract fields:

product title (string)

sale price (number or numeric string; if a range is shown, use the minimum)

product description (string; optional)

product images (array of URLs)

description images (array of URLs)

currency (string, e.g., "CNY") if visible/obvious; otherwise omit.

Image extraction rules:

images[] (ALL product images):

Collect all reachable product-related image URLs, including:

Main gallery images

Thumbnail images

SKU/variant images

Images found in embedded product JSON/state

Normalize image URLs:

Convert protocol-relative URLs (//) to https://

Remove size suffixes if obvious (e.g., _50x50.jpg → .jpg)

Deduplicate URLs.

Exclude obvious UI/decoration icons (logos, arrows, buttons).

description & description_images[] handling:

If description is TEXT:

Put cleaned plain text into "description"

Do NOT include description images in description text

If description is IMAGE-BASED or MIXED:

Extract all description-area image URLs into description_images[]

If there is no meaningful text, omit "description"

Common sources:

Embedded JSON fields (descImages, detailImages, descriptionImages, etc.)

DOM inside description container or description iframe (if already loaded)

Do NOT wait for iframe loading; extract only what is already available.

Description rules:

Prefer short, meaningful summary text if available.

Strip HTML, excessive whitespace, duplicated title text.

If description requires interaction or async loading, omit it.

Output contract (JSON ONLY, no markdown, no extra keys):

{
"url": "string",
"status": "ok | needs_manual | error",
"captured_at": "ISO-8601 UTC timestamp",
"notes": "string (required when status=needs_manual)",
"error": "string (required when status=error)",
"title": "string",
"price": "number or numeric string",
"variations": "string (optional; may be empty string if hard to extract)",
"description": "string (optional)",
"images": ["string"],
"description_images": ["string"],
"currency": "string (optional, e.g., CNY)"
}

Rules:

If status="ok":

title and price are REQUIRED.

images[] MUST be included (empty array allowed if none found).

variations, description, and description_images are optional.

If status="needs_manual":

Include notes describing the blocking wall.

If status="error":

Include error with the failure reason.

Price normalization:

Strip currency symbols, commas, spaces.

Keep only digits and an optional decimal point.

If a range is shown, use the minimum value.
