You are controlling an already-running Google Chrome via Chrome DevTools.

Goal: extract a minimal product payload (title + price) AND crawl variation options with their corresponding main image URLs from a Shopee product page as fast as possible.

Performance rules (important):
- Minimize tool round-trips: prefer 1 navigation + 1-2 evaluate_script calls total.
- Do NOT scroll the whole page, do NOT take screenshots unless blocked.
- Do NOT scan the entire DOM for prices/options; use targeted selectors below.
  - If possible, combine steps (4)-(6) into a single evaluate_script; otherwise use 2 evaluate_script calls (images first, then variations).

Task:
1) Navigate to this Shopee product URL: {{URL}}
2) Wait until the page is ready:
   - document.readyState === "complete", AND
   - a product title is present OR a visible price is present OR page contains embedded product JSON/state.
3) Detect blocking walls early:
   - If the page shows login / verification / CAPTCHA (e.g., "登入", "登錄", "驗證", "captcha", "robot", slider verification),
     return status="needs_manual" with notes explaining what you saw.
4) Extract data (minimal product fields):
   - Prefer embedded structured data (ld+json) if it is easy to access; otherwise use DOM text.
   - Extract:
     - product title (string)
     - sale price (number or numeric string; if a range is shown, use the minimum)
     - product description (string; plain text)
     - currency (string, e.g., "TWD") if visible/obvious; otherwise omit.

   Procedure: product title (fast + reliable)
   - Primary: DOM `h1` (Shopee PDP renders product title as the only prominent heading).
     - In JS: `const title = document.querySelector('main h1, [role="main"] h1, h1')?.innerText?.trim()`
     - If multiple h1 exist, prefer the one that is visible and has the longest non-empty text.
   - Fallback: `meta[property="og:title"]` content (trim trailing site name if present).
   - Last resort: parse `document.title` and take the part before `" | "` (Shopee commonly formats as `<title>... | 蝦皮購物</title>`).

   Procedure: product sale price (fast + reliable)
   - Primary: structured data in `script[type="application/ld+json"]`:
     - Parse all ld+json blocks; look for an object with `@type: "Product"` and an `offers` field.
     - Use `offers.price` (or min of `offers.lowPrice/highPrice` if a range object is provided).
     - Currency: `offers.priceCurrency` when present.
   - Fallback: visible DOM text near the title (avoid scanning the entire page):
     - Get the title element (`h1`) and treat its closest product container as the search root:
       - `const root = titleEl?.closest('main') || document.querySelector('main') || document.body`
     - Collect candidate text nodes/elements inside `root` that look like a price:
       - Matches like `$1,089`, `NT$1,089`, `1,089` (when a nearby currency symbol exists).
     - Exclude likely "original" (strikethrough) prices:
       - ignore elements inside `<del>` / `<s>` or with computed `textDecorationLine` including `"line-through"`.
     - Choose the sale price:
       - If a range is shown (e.g., `$1,089 - $1,299`), take the minimum.
       - If multiple candidates exist (sale + original), prefer the one closest to the title vertically and not strikethrough.
       - Currency:
       - `"TWD"` if `NT$` appears or the page is `shopee.tw` and the symbol is `$`; otherwise omit if ambiguous.

   Procedure: product description (fast + reliable)
   - Primary: structured data in `script[type="application/ld+json"]`:
     - Parse each ld+json block (some may be arrays or contain `@graph`).
     - Find an object where `@type === "Product"` and `description` is a non-empty string.
     - Return that `description` as plain text.
       - Normalize whitespace: trim, collapse excessive whitespace; keep meaningful punctuation.
   - Fallback: DOM section text:
     - Find a visible heading/tab labeled `"商品描述"` (sometimes `"商品詳情"` contains the long text too).
     - If the section is collapsed, click an expand control like `"查看更多"` / `"顯示更多"` near that section.
     - Read the nearest section/container text under that heading.
     - Clean it:
       - Remove the heading label itself.
       - De-duplicate repeated blocks if the UI repeats text.
       - Trim; collapse runs of whitespace to single spaces (or keep `\n` if the text is clearly multi-paragraph).
   - If both methods fail but the page is otherwise OK, set description to an empty string ONLY if you are sure no description exists; otherwise return status="error" with why you couldn’t locate it.

5) Extract product images (from the image viewer modal RIGHT sidebar thumbnails):
   Goal: return the list of product image thumbnail URLs that show on the right side of Shopee's image viewer modal.

   Observed behavior on Shopee PDP:
   - Clicking a product thumbnail (or the main image) opens an image viewer modal overlay.
   - The modal has a right-side column with a scrollable grid/list of thumbnails.
   - Those thumbnail URLs typically look like:
     - https://down-tw.img.susercontent.com/file/<image_id>@resize_w82_nl.webp

   Step-by-step procedure (implement inside ONE evaluate_script):
   A) Open the image viewer modal:
      - Try clicking the main gallery image: img[alt^="Product image"] (or its closest clickable parent).
      - If no modal appears, click the first gallery thumbnail below the main image (query for nearby img elements under the gallery).
      - Wait until a modal exists: document.querySelector('[role="dialog"]') is present and visible.
      - If a blocking wall appears (login/verify/CAPTCHA), return status="needs_manual".
      - If the modal cannot be opened after reasonable attempts, return status="error".

   B) Identify the RIGHT thumbnail list container inside the modal:
      - const dialog = document.querySelector('[role="dialog"]')
      - Find a scrollable element inside dialog:
        - Look for elements where getComputedStyle(el).overflowY is "auto" or "scroll"
        - Prefer candidates whose bounding rect is on the right half of the dialog (rect.left > dialogRect.left + dialogRect.width * 0.55)
        - Fallback to any scrollable element with a tall height if the right-half heuristic fails.

   C) Collect ALL thumbnail URLs by scrolling the right sidebar container:
      - Define a collector that:
        - iterates dialog.querySelectorAll('img') (or sidebarContainer.querySelectorAll('img') if you found it)
        - reads img.currentSrc || img.src and parses img.srcset
        - filters to URLs containing "down-tw.img.susercontent.com/file/" AND "@resize_w82_nl.webp"
        - de-duplicates while PRESERVING first-seen order
      - If a scrollable sidebar container is found:
        - scrollTop from 0 -> max in ~10-12 steps
        - after each scroll step, wait 200-300ms then collect again
        - finally scrollTop back to 0
      - Result: `images` should be an array of objects:
        - { url: string, position: integer } where position is 0-based in the preserved order

6) Extract variation options and the corresponding main image URL for each option:
   Context observed on Shopee PDP:
   - Variation section label is often shown as a heading like "規格" (but could also be "顏色", "尺寸", "款式", etc.)
   - Options are usually rendered as <button> elements styled as selection boxes.
     Practical selectors/patterns:
       - option button has an aria-label (e.g., "白", "灰")
       - option button className often contains "selection-box"
       - selected option button className often contains "selection-box-selected"
       - unavailable options may have aria-disabled="true" (note: in practice it can still be clickable and still updates the main image)
   - The main product image is shown near the top-left gallery:
       - main image element: img[alt^="Product image"]
       - it is usually inside a <picture>; prefer the largest URL from <source srcset> (often the "2x" / w900 URL)

   Step-by-step procedure:
   Prefer implementing this as ONE evaluate_script that:
   - Locates variation option buttons (near headings like: "規格","顏色","尺寸","款式","型號","容量","組合")
   - For each option button:
     - reads option name from aria-label (preferred) or innerText
     - reads availability from aria-disabled / disabled
     - clicks the button (even if aria-disabled="true")
     - waits for the main image (img[alt^="Product image"]) to update (alt or src change)
     - captures image_url as the largest URL from the <source srcset> (prefer 2x/w900), fallback to img.currentSrc/img.src
   - Returns an array of {group, option, available, image_url}.

Output contract (JSON ONLY, no markdown):
{
  "url": "string",
  "status": "ok | needs_manual | error",
  "captured_at": "ISO-8601 UTC timestamp",
  "notes": "string (required when status=needs_manual)",
  "error": "string (required when status=error)",
  "title": "string",
  "description": "string",
  "price": "number or numeric string",
  "currency": "string (optional, e.g., TWD)",
  "images": [
    {
      "url": "string",
      "position": 0
    }
  ],
  "variation_images": [
    {
      "group": "string (e.g., 規格)",
      "option": "string (e.g., 白)",
      "available": "boolean",
      "image_url": "string"
    }
  ]
}

Rules:
- If status="ok": include title, description, and price (and currency when obvious).
- If status="needs_manual": include notes describing the wall.
- If status="error": include error (string) with the failure reason.
- Do NOT output placeholder type-descriptions like "string" or "boolean" as values; output real values with correct JSON types.
- Normalize price:
  - Strip currency symbols, commas, spaces; keep only digits and an optional decimal point.
  - If the page shows a range, use the minimum.
- images:
  - Return 1+ entries when status="ok" (empty only if the page truly has no images).
  - Prefer the modal right-sidebar thumbnail URLs matching `@resize_w82_nl.webp`.
  - De-duplicate while preserving first-seen order; set `position` accordingly.
- variation_images:
   - Include 0+ entries (empty array if no variations are present).
   - De-duplicate by (group, option).
   - image_url must be the post-click main image URL for that option (prefer the largest srcset URL when available).
